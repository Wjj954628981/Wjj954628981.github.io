---
title: HTTP协议
date: 2020-02-22 18:50:16
tags: [计算机网络]
---

HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写，是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。

<!--more-->

#### HTTP的概念
HTTP是超文本传输协议，用来沟通客户端与服务器。

#### 什么是TCP/IP？跟HTTP有什么关系？
tcp/ip是全世界的计算机和网络设备常用的层次化分组交换网络协议集！简单的说，http协议是一个应用层协议，位于tcp/ip协议的上一层，tcp/ip协议的主要作用就是过滤掉每个计算机的差异性，隐藏相关弱点，使得对于http协议来说提供的都是“相同的”接口！

#### HTTP方法有哪些？
方法就是客户端向服务器发起的请求命令！常见方法有：get、post、delete、put、head！

### HTTP报文
报文由**起始行、首部、主体**三个部分组成，起始行和首部都是ascll文本，而主体则可以是任意类型文件。
报文分为**请求报文**和**响应报文**两种类型，语法分别如下：
```
//请求报文
<method> <request-URL> <version>
<headers>
<entity-body>

//响应报文
<version> <status> <reason-phrase>
<headers>
<entity-body>
```

#### 首部
包含通用首部、请求首部、响应首部、主体首部、扩展首部。
##### 通用首部
|首部|描述|
|-|-|
|Connection|允许客户端和服务器指定与请求/响应连接有关的选项，比如keep-alive
|Date|报文创建日期
|Cache-Control|用于随报文传送缓存指示
##### 请求首部
|首部|描述|
|-|-|
|Host|接收请求的服务器的主机名和端口号
|User-Agent|发起请求的应用程序名称
|**Accept首部**
|Accept|告诉服务器能够发送那些媒体类型
|Accept-Charset|告诉服务器能够给发送那些字符集
|Accept-Encoding|告诉服务器能够发送那些编码方式
|Accept-Language|告诉服务器能够发送那些语言
|**安全请求首部**
|Authorization|包含了客户端提供给服务器，以便对其自身进行认证的数据
|Cookie|客户端用它向服务器传送一个令牌————它并不是真正的安全首部，但确实隐含了安全功能
##### 响应首部
|首部|描述|
|-|-|
|Set-Cookie|在客户端设置一个令牌，以便服务器对客户端进行标志
##### 实体首部
|首部|描述|
|-|-|
|Location|告知客户端实体实际上位于何处，用于将接收端重定向到资源的位置上去
|**内容首部**
|Content-Type|主体的对象类型
|Content-Encoding|对主体执行的任意编码方式
|Content-Language|理解主体时最适宜使用的自然语言
|Content-Length|主体的长度
|Content-MD5|主体的MD5校验和
|**实体缓存首部**
|ETag|与此实体相关的实体标记
|Expires|实体不再有效，要从原始的源端再次获取此实体的日期和时间
|Last-Modified|这个实体最后一次被修改的日期和时间

#### 状态码
|状态码|原因短语|含义|
|-|-|-|
|**1xx**||**信息性状态码**
|100|Continue|说明收到了请求的初始部分，请客户端继续，发送了这个状态码之后，服务器在收到请求之后必须进行响应。
|**2xx**||**成功状态码**
|200|OK|请求没问题，实体的主体部分包含了所请求的资源。
|202|Accepted|请求已被接受，但服务器还未对其执行任何动作。不能保证服务器会完成这个请求；这只是意味着接受请求时，它看起来是有效的。服务器应该在实体的主体部分包含对请求状态的描述，或许还应该有对请求完成时间的估计。（或者包含一个指针，指向可以获取此信息的位置）
|**3xx**||**重定向状态码**
|300|Multiple Choices|客户端请求一个实际指向多个资源的URL时会返回这个状态码，比如服务器上有某个HTML文档的英语和法语版本。返回这个代码时会带有一个选项列表；这样用户就可以选择它希望使用的那一项了。有多个版本可用时，客户端需要沟通解决。
|301|Moved Permanently|在请求的URL已被移除时使用。响应的Location首部中应该包含资源现在所处的URL。
|302|Found|与301状态码类似，但是，客户端应该使用Location首部给出的URL来临时定位资源。将来的请求仍应该使用老的URL。
|304|Not Modified|客户端可以通过所包含的请求首部，使其请求变成有条件的。如果客户端发起了一个条件GET请求，而最近资源未被修改的话，就可以用这个状态码来说明资源未被修改。带有这个状态码的响应不应该包含实体的主体部分。
|**4xx**||**客户端错误状态码**
|400|Bad Request|用于告知客户端发起了一个错误的请求。
|401|Unauthorized|返回适当的首部，用于获取客户端访问资源的权限。
|403|Forbidden|服务器拒绝请求，可在响应主体中告知原因。
|404|Not Found|用于告知客户端请求的资源在服务器不存在。
|**5xx**||**服务端错误状态码**
|500|Internal Server Error|服务器错误。
|502|Bad Gateway|作为代理或网关使用的服务器从请求响应链的下一条链路上收到了一条伪响应（比如，它无法连接到其父网关）时，使用此状态码。
|503|Service Unavailable|用来说明服务器现在无法为请求提供服务，但将来可以。如果服务器知道什么时候资源会变为可用的，可以在响应中包含包含一个Retry-After首部。
|504|Gateway Timeout|网关或代理在等待另一服务器对其请求进行响应时超时了。

### 在一次网络请求中，分别经历那些过程？（参考《计算机网络-自顶向下方法》p329）
- 准备：DHCP、UDP、IP和以太网
    - **新加入设备A**。操作系统生成**DHCP请求报文a**，a放入目的端口67和源端口68的**UDP报文b**，b放置在具有广播IP目的地址（255.255.255.255）和源IP地址0.0.0.0的**IP数据报c**。
    - 上述c放置在具有广播MAC目的地址（FF:FF:FF:FF:FF:FF）和源MAC地址（A.mac）的**以太网帧x**，该以太网帧x将广播到与**交换机**连接的所有设备（包括DHCP服务器）
    - **网关路由器gatway**在其MAC地址为gatway.mac的接口接收到以太网帧x，并从中抽出IP数据报c。由于c的目的地址为广播IP地址，因此判断该IP数据报应该有该节点的高层协议处理，因此UDP报文b及DHCP请求报文a依次被抽取，达到**DHCP服务器**。
    - 假设DHCP服务器能够以**CIDR**块gatway.cidr分配IP地址。DHCP服务器生成包含**分配IP地址**A.ip、**DNS服务器IP地址**dns.ip、默认**网关路由器IP地址**gatway.ip和**网络掩码**gatway.netmask的**DHCP ACK报文**，该报文依次放入UDP->IP->**以太网帧y**（目的MAC地址为A.mac）。
    - 路由器将以太网帧y发送给交换机，因为交换机是**自学习**的，因此可以知道寻址到A.mac的以太网帧的路径。
    - 设备A接收到包含DHCP ACK报文的以太网帧，从中抽取信息初始化网络组件。
- 仍在准备：DNS和ARP
    - 键入URL后需要知道**域名domain**到IP地址的转换，依次查询**浏览器缓存**、**本地DNS域名解析host**如果为空，则生成一个**DNS查询报文d**，该报文依次放入UDP（目的端口53）->IP（目的IP为dns.ip）->**以太网帧z**，z将寻址到网关路由器。
    - 由于设备A并不知道网关路由器的MAC地址，因此需要先生成**ARP查询报文e**，通过以太网帧广播达到网关路由器后，网关路由器生成**ARP回答报文**返回给设备A。
    - 设备A获得到**网关路由器的MAC地址gateway.mac**后，将包含DNS查询报文d的以太网帧z发送给交换机，交换机将其交付给网关路由器。
- 仍在准备：域内选择到DNS服务器
    - 网关路由器根据IP数据报的目的地址，根据其转发表进行转发到下一跳路由器，再经过多次跳转达到DNS服务器。跳转依据的转发表是根据网络的**域内协议（RIP、OSPF等）**及**域间协议BGP**所填写。
    - 最终DNS查询报文d到达了DNS服务器。DNS服务器抽取查询报文，查询**域名的IP地址α**并生成**DNS回答报文e**（通过DNS域名解析查询），该报文依次放入UDP->IP->以太网帧最终到达设备A。
- WEB客户-服务器交互：TCP和HTTP
    - 设备A根据域名domain的IP地址α生成**TCP套接字**，用于向domain发送**HTTP GET报文**。TCP报文放置在目的IP地址α的IP数据报，IP数据报放置在MAC地址为gateway.mac的以太网帧。
    - 经过TCP三次握手，HTTP GET报文终于到达α并被解析，最终生成**HTTP响应报文**发送至TCP套接字。
- 浏览器渲染
    - 从HTTP响应报文拿到HTML实体后，浏览器根据HTML内容将标签解析为DOM树（解析过程遇到script标签则暂停DOM树构建执行脚本），根据CSS解析CSS规则树（解析CSS时将暂停js脚本），根据DOM树及CSS规则树成生成渲染树，进行页面绘制。