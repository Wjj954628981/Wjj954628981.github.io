---
title: 面试题-分布式系统
date: 2020-03-10 01:53:33
tags: [面试, 算法, 分布式]
---

本文参考《大规模分布式存储系统-第三章.分布式系统》，对分布式系统相关的基础概念进行一个大致的讲解与总结，结合本人对于分布式的一点点理解，旨在为有意学习分布式系统的同学提供一点点帮助，同时也对自己的知识进行加深理解与巩固。详细的理论和概念还请直接阅读原文。

<!--more-->

# 基本概念

一个服务器或者服务器上运行的一个进程称之为一个**节点**，节点与节点之间通过网络互相连接。

## 异常
分布式系统中，由于其规模一般比较大，通过人工的方式来维护整个集群基本上不可能，因此大规模分布式系统的一个**核心问题**在于**自动容错**。那么，如何发现异常，就是自动容错实现的基础。

### 异常类型

#### 服务器宕机
服务器宕机后，节点的所有服务不可用，分布式系统需要应对两种情况：
1. 节点永久性失效，分布式系统需要考虑如何对数据重新分配，避免负载不均衡。
2. 节点暂时不可用，分布式系统需要考虑如何通过读取**持久化介质**中的数据恢复内存信息，从而恢复宕机之前的某个一致状态。

#### 网络异常
引发网络异常的原因可能是：消息丢失、消息乱序、网络包数据错误、网络分区（集群所有节点被划分为多个区域）。
> 设计容错系统的一个基本原则是：**网络永远是不可靠的**，任何一个消息只有收到对方的回复后才能认为发送成功。

#### 磁盘故障
磁盘故障是一种发生概率很高的异常，分为：**磁盘损坏**和**磁盘数据错误**。
> 磁盘数据错误可以通过**检验和（checksum）**来完成检测。

### 超时
在单机系统中，每个函数的执行结果是确定的，成功or失败。但是，分布式系统的**RPC**（Remote Procedure Call）调用结果有三种：成功、失败、超时，被称为分布式存储系统的三态。
出现超时之后，只能通过不断重试来验证RPC操作是否成功，因此分布式系统的执行操作应该是幂等的（如覆盖写）。

## 一致性
为了保证在异常情况下分布式系统的可用性，往往会将数据冗余地存储多份，每一份称之为**副本**。

> **副本是分布式存储系统容错技术的唯一手段。如何保证副本之间的一致性是整个分布式系统的核心理论。**

### 一致性的分类

#### 客户端角度
1. **强一致性**
2. **弱一致性**
3. **最终一致性**，从写入单个节点到全部节点数据一致的过程称之为**不一致窗口**

#### 存储系统角度
1. 副本一致性
2. 更新顺序一致性

## 衡量标准
- **性能**。常见的性能指标有：吞吐能力（QPS、TPS）和响应时间
- **可用性**。指的是系统在面对各种异常时可提供正常服务的能力，可以简单的按照系统服务不可用与正常服务的时间比例来衡量。
- **一致性**。越是强的一致性模型，用户使用起来越简单。
- **可扩展性**。指的是分布式存储系统通过扩展集群服务器规模来提高系统存储容量、计算量和性能的能力。

## 一致性理论

### CAP理论
一个分布式系统不可能同时满足：**一致性**（Consistency）、**可用性**（Availability）、**分区容错性**（Partition tolerance），最多只能同时满足其中两项。

- 一致性：多个副本数据之间能够保持一致的特性
- 可用性：指系统提供的服务必须一直处于可用的状态，每次请求都能获取到非错的响应
- 分区容错性：分布式系统在遇到任何网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务，除非整个网络环境都发生了故障。

另一版本的解释（在参考三中进行解释，个人认为对于CAP描述更加清晰且明确）：
- C：一致性被称为原子对象，任何的读写都应该看起来是“原子“的，或串行的。写后面的读一定能读到前面写的内容，所有的读写请求都好像被全局排序。
- A：对任何非失败节点都应该在有限时间内给出请求的回应（请求的可终止性）。
- P：允许节点之间丢失任意多的消息，当网络分区发生时，节点之间的消息可能会完全丢失。

> 因为无法保证网络硬件一定不出现问题，因此分区容错性一定需要满足，CAP理论需要在C和A上做取舍。

### BASE理论
BASE是Basically Available（基本可用），Soft state（软状态），和Eventually consistent（最终一致性）三个短语的缩写。
- 基本可用。允许出现响应时间损失或者功能损失。
- 软状态。允许系统中的数据存在中间状态，并认为该状态不影响系统的整体可用性，即允许系统在多个不同节点的数据副本存在数据延时。
- 最终一致性。系统能够保证在没有其他新的更新操作的情况下，数据最终一定能够达到一致的状态，因此所有客户端对系统的数据访问最终都能够获取到最新的值。

--- 

# 数据分布
分布式系统区别于传统单机系统在于能够将数据分布到多个节点，并在多个节点实现自动负载均衡。

## 哈希分布

## 顺序分布

## 负载均衡

--- 

# 复制

--- 

# 容错

--- 

# 可扩展性

--- 

# 分布式协议

--- 

# 跨机房部署

### 参考
- 《大规模分布式存储系统-第三章.分布式系统》
- [分布式一致性算法](https://www.jianshu.com/p/40dbe406d2f4)
- [CAP理论](https://blog.csdn.net/chen77716/article/details/30635543)